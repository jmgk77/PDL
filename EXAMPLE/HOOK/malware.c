#include <stdio.h>
#include <stdlib.h>
#include <windows.h>

typedef int(WINAPI *MY_API)(char *);

HMODULE lib;
MY_API api;

__declspec(dllexport) int __cdecl CheckPassword(char *buf) {
  if (buf[0] == '!')
    return 1;
  return api(buf);
}

BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved) {
  switch (fdwReason) {
  case DLL_PROCESS_ATTACH:
    lib = LoadLibrary("PROXY.DLL");
    api = (MY_API)GetProcAddress(lib, "CheckPassword");
    break;

  case DLL_PROCESS_DETACH:
    FreeLibrary(lib);
    break;
  }

  return TRUE;
}